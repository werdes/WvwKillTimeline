function setView(t){$("#matchlist-container").addClass("hidden"),$("#match").addClass("hidden"),t==ENUM_VIEW.MATCH?$("#match").removeClass("hidden"):t==ENUM_VIEW.MATCHLIST&&$("#matchlist-container").removeClass("hidden")}function getMaps(t){var a=new Array;return a[38]="Eternal Battlegrounds",a[94]=t.red+" Borderlands",a[95]=t.green+" Borderlands",a[96]=t.blue+" Borderlands",a[1099]=t.red+" Borderlands",a}function getMapColors(){var t=new Array;return t[38]="#333",t[94]="red",t[95]="green",t[96]="blue",t[1099]="red",t}function getWorlds(t){var a=new Array;a.red=null,a.green=null,a.blue=null;for(var r in t.series){var e=t.series[r];a[e.color]=e.world_name}return a}function setSpecificMatch(t){setLoading(!0),setView(ENUM_VIEW.NONE),$.ajax({url:"inc/matchlist.php?all&"+$.now(),caching:!1,dataType:"json",complete:function(a){for(var r in a.responseJSON){var e=a.responseJSON[r];if(e.id==t){setMatch(e.id,e);break}}},error:function(t,a,r){$("#message-container").html('<div class="alert alert-danger" role="alert"><b>'+a+"</b><br />"+r+"</div>"),setView(ENUM_VIEW.MATCHLIST)}})}function setAllMatchlist(){var t="#matchlist-container";setLoading(!0),$(t).html(""),resetChart(),setView(ENUM_VIEW.NONE),$.ajax({url:"inc/matchlist.php?all&"+$.now(),dataType:"json",complete:function(a){setView(ENUM_VIEW.NONE);var r="";for(var e in a.responseJSON){var s=a.responseJSON[e],i=moment(s.start).utc().format("YYYY.MM.DD");i!=r&&($(t).append("<h2>"+moment(s.start).format("DD.MM.YYYY")+" - "+moment(s.end).format("DD.MM.YYYY")+"</h2>"),r=i),setMatchlistMatchContainer(t,e,s)}$("div#matchlist-container div.list-group-item a.match-container").click(function(){var t=$(this).attr("data-match-id"),a=$(this).data("match");setMatch(t,a)}),setLoading(!1),setView(ENUM_VIEW.MATCHLIST)},error:function(t,a,r){$("#message-container").html('<div class="alert alert-danger" role="alert"><b>'+a+"</b><br />"+r+"</div>")}})}function setCurrentMatchlistMainMenu(){var t="#menu-current-matchups";$.ajax({url:"inc/matchlist.php?current&"+$.now(),dataType:"json",complete:function(a){for(var r in a.responseJSON){var e=a.responseJSON[r],s=e.arenanet_id.split("-")[1],i="1"==e.arenanet_id.split("-")[0]?"NA":"EU";$(t).append('<li data-match-id="'+e.id+'" id="menu-'+r+'"></li>');var o='<a href="javascript:void(0);"><b>'+i+"</b>/<b>T"+s+"</b> ",l=0;for(var n in e.worlds){var d=e.worlds[n];l>0&&(o+=" - "),o+='<i class="famfamfam-flag-'+getFlagShort(d.id)+'"></i> ',o+=d.name,l++}o+="</a>",$("#menu-"+r).append(o),$("#menu-"+r).data("match",e)}$("ul#menu-current-matchups li").click(function(){var t=$(this).attr("data-match-id"),a=$(this).data("match");setMatch(t,a)})},error:function(t,a,r){$("#message-container").html('<div class="alert alert-danger" role="alert"><b>'+a+"</b><br />"+r+"</div>")}})}function setCurrentMatchlist(){var t="#matchlist-container";$(t).html(""),$.ajax({url:"inc/matchlist.php?current&"+$.now(),dataType:"json",complete:function(a){setView(ENUM_VIEW.NONE);for(var r in a.responseJSON)setMatchlistMatchContainer(t,r,a.responseJSON[r]);$("div#matchlist-container div.list-group-item a.match-container").click(function(){var t=$(this).attr("data-match-id"),a=$(this).data("match");setMatch(t,a)}),setLoading(!1),setView(ENUM_VIEW.MATCHLIST)},error:function(t,a,r){$("#message-container").html('<div class="alert alert-danger" role="alert"><b>'+a+"</b><br />"+r+"</div>")}})}function setMatchlistMatchContainer(t,a,r){var e=r.arenanet_id.split("-")[1],s="1"==r.arenanet_id.split("-")[0]?"NA":"EU";$(t).append('<div id="'+a+'" class="list-group-item"><div class="row"><div class="col-md-1"><div class="matchlist-eyecatcher"><span class="matchlist-region">'+s+'</span><span class="matchlist-tier">Tier '+e+'</span></div></div><div class="col-md-10"><a class="match-container" data-match-id="'+r.id+'"></a></div><div class="col-md-1"><a class="get-shortlink btn btn-default btn-xs pull-right" data-toggle="modal" data-target="#modal-shortlink" role="button" data-match-id="'+r.id+'"><i class="glyphicon glyphicon-link"></i> Shortlink</a></div></div></div>');var i='<div class="matchlist-worldlist">';for(var o in r.worlds){var l=r.worlds[o],n=parseInt(l.kills)/parseInt(l.deaths),d=n>=1?"success":"danger";if(i+='<div class="row"><div class="col-md-1">',i+='<span title="Kills: '+l.kills+" / Deaths: "+l.deaths+'" class="label label-'+d+'">KD: '+getKdr(l.kills,l.deaths)+"</span>",i+='</div><div class="col-md-11 matchlist-world-container"><b><i class="famfamfam-flag-'+getFlagShort(l.id)+'"></i> '+l.name+"</b>",null!=l.additional_worlds)for(var c in l.additional_worlds)i+=", "+l.additional_worlds[c].name;i+="</div></div>"}i+="</a></div>",$("#"+a+" a.match-container").append(i),$("#"+a+" a.match-container").data("match",r)}function setMatch(t,a){setView(ENUM_VIEW.NONE),setLoading(!0),resetChart(),m_oHighchartsKills=new Highcharts.stockChart(getChartOptions()),$.ajax({url:"inc/match.php?match_id="+t+"&"+$.now(),dataType:"json",complete:function(r){var e=r.responseJSON,s=0,i=getWorlds(e),o=getMaps(i),l=0,n=0;$("div#match > a.get-shortlink").attr("data-match-id",a.id),m_oHighchartsKills.setTitle({text:i.green+" / "+i.blue+" / "+i.red});var d=0,c=e.series[Object.keys(e.series)[0]];for(var h in c.series_items){var m=(c.series_items[h],0),p=0;for(var u in e.series)oSeries=e.series[u],m+=parseInt(oSeries.series_items[d].kills),p+=parseInt(oSeries.series_items[d].deaths);m>l&&(l=m),p>n&&(n=p),d++}var v=l;n>v&&(v=n),n*=-1,m_oHighchartsKills.yAxis[0].update({min:v*-1-100,max:0}),m_oHighchartsKills.yAxis[1].update({min:0,max:v+100});for(var u in e.series)setSeries(e.series[u],i,o,s,"Kills"),s++;for(var u in e.series)setSeries(e.series[u],i,o,s,"Deaths"),s++;setMatchStatistics(e,a),$("#reload-chart").attr("data-match-id",t),$("#reload-chart").data("match",a),m_oHighchartsKills.redraw(),setLoading(!1),setView(ENUM_VIEW.MATCH)},error:function(t,a,r){$("#message-container").html('<div class="alert alert-danger" role="alert"><b>'+a+"</b><br />"+r+"</div>")}})}function setSeries(t,a,r,e,s){var i="Deaths"==s;m_oHighchartsKills.addSeries({name:"["+s+"] "+t.world_name+" on "+r[t.map_id],yAxis:i?0:1,type:"area",step:"center",color:getMapChartColor(t.color,t.map_id,i)});for(var o in t.series_items){var l=t.series_items[o],n=i?parseInt(l.deaths)*-1:parseInt(l.kills);m_oHighchartsKills.series[e].addPoint({x:Date.parse(l.timeslot_start),y:n,name:l.timeslot_start+" to "+l.timeslot_end,world:t.world_id,map:t.map_id,kills:parseInt(l.kills),deaths:parseInt(l.deaths)},!1)}}function setMatchStatistics(t,a){var r="#match-statistics-container",e=new Array,s=getMapColors();$(r).html("");for(var i in t.series){var o=t.series[i],l=o.world_id;"undefined"==typeof e[l]&&(e[l]={world_id:o.world_id,color:o.color,world_name:o.world_name,maps:new Array}),e[l].maps[o.map_id]={map_id:o.map_id,kills:0,deaths:0};for(var n in o.series_items){var d=o.series_items[n];e[l].maps[o.map_id].kills+=parseInt(d.kills),e[l].maps[o.map_id].deaths+=parseInt(d.deaths)}}var c='<div class="row">';for(var h in e){oWorld=e[h],c+='<div class="col-md-4 world-container '+oWorld.world_id+'" data-world-name="'+oWorld.world_name+'">',c+='<div class="row"><div class="col-md-9"><h4>'+oWorld.world_name+'</h4><span class="copy-statistics copy-'+oWorld.world_id+'" title="Copy statistics to clipboard"><i class="glyphicon glyphicon-copy"></i></span></div><div class="col-md-3 world-kd '+oWorld.world_id+'"><h4>&empty;1.00</h4></div></div><h6>';var m=0;for(var p in a.worlds[oWorld.color].additional_worlds)m++,c+=a.worlds[oWorld.color].additional_worlds[p].name,m<Object.keys(a.worlds[oWorld.color].additional_worlds).length&&(c+=", ");c+="&nbsp;</h6>";for(var u in oWorld.maps){var v=oWorld.maps[u],g="38"==v.map_id?"EBG":"Border",f=getKdr(v.kills,v.deaths),w=getWidths(parseInt(v.kills),parseInt(v.deaths));c+='<div class="row kd" data-kills="'+v.kills+'" data-deaths="'+v.deaths+'" data-world="'+oWorld.world_id+'" data-map-id="'+u+'" data-color="'+s[v.map_id]+'" data-world-name="'+oWorld.world_name+'" data-map-name="'+g+'">',c+='<div class="col-md-2" style="color: '+s[v.map_id]+'">'+g+'</div><div class="col-md-7"><div class="progress"><div class="progress-bar '+u+" "+oWorld.world_id+' kills" title="kills" role="progressbar" style="width: '+w[0]+"%; background-color: "+getMapChartColor(oWorld.color,v.map_id,!1)+';"  >'+v.kills+'</div><div class="progress-bar '+u+" "+oWorld.world_id+' deaths" style="width: '+w[1]+"%; background-color: "+getMapChartColor(oWorld.color,v.map_id,!0)+';" title="deaths">'+v.deaths+'</div></div></div><div class="col-md-3 '+u+" "+oWorld.world_id+' kdr">&empty;'+f+"</div>",c+="</div>"}c+="</div>"}c+="</div>",$(r).append(c),$("span.copy-statistics").click(function(){$(this).addClass("highlight"),setTimeout(function(){$(".highlight").removeClass("highlight")},1e3)});for(var h in e){for(var _ in e[h].maps)setWorldKdr(e[h].world_id,e[h].maps[_].kills,e[h].maps[_].deaths);$(".copy-"+e[h].world_id).attr("data-clipboard-text",getClipboardWorld(e[h].world_id)),new Clipboard(".copy-"+e[h].world_id)}}function getClipboardWorld(t){var a=0,r=0,e=new Array,s=$(".world-container."+t).attr("data-world-name");$(".world-container."+t).children(".row.kd").each(function(){var t=parseInt($(this).attr("data-kills")),s=parseInt($(this).attr("data-deaths")),i=($(this).attr("data-world-name"),$(this).attr("data-map-name")),o=$(this).attr("data-color");a+=s,r+=t;var l=getKdr(t,s)+" k/d ("+t+"/"+s+") on ";o.indexOf("#")==-1&&(l+=o.toProperCase()+" "),l+=i,e.push(l)});var i=s+": "+getKdr(r,a)+" k/d ("+r+"/"+a+") | ";return i+e.join(" | ")}function resetChart(){void 0!=m_oHighchartsKills&&null!=m_oHighchartsKills&&(m_oHighchartsKills.destroy(),m_oHighchartsKills=void 0,$("main-chart-container").html(""))}function getFlagShort(t){var a=t.substring(0,2);switch(a){case"10":return"us";case"20":return"eu";case"21":return"fr";case"22":return"de";case"23":return"es"}}function setLoading(t){$("#loading-container").removeClass("hidden"),t||$("#loading-container").addClass("hidden")}function getChartOptions(){Highcharts.setOptions({global:{useUTC:!1}});var t={chart:{backgroundColor:"transparent",renderTo:"main-chart-container",height:500,zoomType:"xy"},rangeSelector:{enabled:!1},xAxis:{type:"datetime",range:864e5,labels:{align:"left"}},title:{text:" "},yAxis:[{allowDecimals:!1,title:{text:"deaths"},opposite:!0,gridLineWidth:0,visible:!1,labels:{formatter:function(){return Math.abs(this.value)}}},{allowDecimals:!1,title:{text:"kills / deaths"},opposite:!0,gridLineWidth:0,labels:{formatter:function(){return Math.abs(this.value)}}}],plotOptions:{area:{stacking:"normal"}},series:[]};return t}function newGuid(){return(S4()+S4()+"-"+S4()+"-4"+S4().substr(0,3)+"-"+S4()+"-"+S4()+S4()+S4()).toLowerCase()}function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function getMapChartColor(t,a,r){var e=0;switch(a){case"34":e=.09;break;case"95":e=.15;break;case"96":e=.3;break;case"1099":case"97":e=.45}r&&(e=-.75+e);var s=shadeColor(colorNameToHex(t),e);return s}function colorNameToHex(t){var a={blue:"#0000ff",green:"#008000",red:"#ff0000"};return"undefined"!=typeof a[t.toLowerCase()]&&a[t.toLowerCase()]}function shadeColor(t,a){var r=parseInt(t.slice(1),16),e=a<0?0:255,s=a<0?a*-1:a,i=r>>16,o=r>>8&255,l=255&r;return"#"+(16777216+65536*(Math.round((e-i)*s)+i)+256*(Math.round((e-o)*s)+o)+(Math.round((e-l)*s)+l)).toString(16).slice(1)}function blendColors(t,a,r){var e=parseInt(t.slice(1),16),s=parseInt(a.slice(1),16),i=e>>16,o=e>>8&255,l=255&e,n=s>>16,d=s>>8&255,c=255&s;return"#"+(16777216+65536*(Math.round((n-i)*r)+i)+256*(Math.round((d-o)*r)+o)+(Math.round((c-l)*r)+l)).toString(16).slice(1)}function setTotalNumbersInStatistics(t){var a=$(t).data("kills"),r=$(t).data("deaths"),e=$(t).find(".progress-bar.deaths"),s=$(t).find(".progress-bar.kills"),i=$(t).find(".kdr"),o=getWidths(a,r),l=getKdr(a,r);$(e).text(r),$(s).text(a),$(e).css("width",o[1]+"%"),$(s).css("width",o[0]+"%"),$(i).html("&empty;"+l),setWorldKdr($(t).attr("data-world"),a,r),m_oHighchartsKills.setTitle({text:m_oHighchartsKills.title.textStr})}function getWidths(t,a){var r=new Array;return r=0==t&&0==a?[50,50]:[100*t/(t+a),100*a/(t+a)]}function getKdr(t,a){return t>0?a>0?parseFloat(Math.round(t/a*100)/100).toFixed(2):"&infin;":"0.00"}function getParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=a.exec(location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function setWorldKdr(t,a,r){var e=".world-kd."+t,s=$(e).attr("data-count");if("undefined"==typeof s?($(e).attr("data-count",0),$(e).attr("data-kills",0),$(e).attr("data-deaths",0),s=0):s=parseInt(s),$(e).attr("data-count",s+1),$(e).attr("data-kills",parseInt($(e).attr("data-kills"))+a),$(e).attr("data-deaths",parseInt($(e).attr("data-deaths"))+r),s=$(e).attr("data-count"),4==s){var i=parseInt($(e).attr("data-kills")),o=parseInt($(e).attr("data-deaths"));$(e).html("<h4>&empty;"+getKdr(i,o)+"</h4>"),$(e).attr("data-count",0),$(e).attr("data-kills",0),$(e).attr("data-deaths",0)}}var m_oHighchartsKills;$(function(){new Clipboard("#copy-shortlink"),setCurrentMatchlistMainMenu(),getParameterByName("match")?setSpecificMatch(getParameterByName("match")):setCurrentMatchlist()}),$("#show-all-matches").click(function(){setAllMatchlist()}),$("#headline").click(function(){setCurrentMatchlist()});var ENUM_VIEW={NONE:0,MATCHLIST:1,MATCH:2};$("#modal-shortlink").on("shown.bs.modal",function(t){var a=$(t.relatedTarget),r=a.attr("data-match-id"),e=window.location.href.replace("#","").split("?")[0]+"?match="+r;$("#shortlink-textbox").val(e),$("#shortlink-textbox").select()}),$("#reload-chart").click(function(){var t=$(this).data("match"),a=$(this).attr("data-match-id");setMatch(a,t)}),Highcharts.Point.prototype.tooltipFormatter=function(t){var a=this,r=(a.series,".progress-bar.kills."+a.map+"."+a.world),e=".progress-bar.deaths."+a.map+"."+a.world,s=".kdr."+a.map+"."+a.world,i=getKdr(a.kills,a.deaths),o=getWidths(a.kills,a.deaths);return $(r).text(a.kills),$(e).text(a.deaths),$(s).html("&empty;"+i),$(r).css("width",o[0]+"%"),$(e).css("width",o[1]+"%"),setWorldKdr(a.world,a.kills,a.deaths),t?"":"<b>x = "+(a.name||a.x)+",</b> "},$("#main-chart-container").mouseleave(function(){$(".row.kd").each(function(){setTotalNumbersInStatistics(this)})}),String.prototype.toProperCase=function(){return this.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})};