function loadSettings(){var e=$.cookie("settings");null!=e&&null!=e||(storeSettings(),e=$.cookie("settings"));var t=JSON.parse(e);_SETTINGS.darkmode=null!=t.darkmode?t.darkmode:_SETTINGS.darkmode,_SETTINGS.flattening=null!=t.flattening?t.flattening:_SETTINGS.flattening,_SETTINGS.smoothing=null!=t.smoothing?t.smoothing:_SETTINGS.smoothing,_SETTINGS.dismissed_objects=null!=t.dismissed_objects?t.dismissed_objects:_SETTINGS.dismissed_objects,$(".grp-options li.checkable > a").each(function(){$(this).find(".glyphicon").css("opacity",_SETTINGS[$(this).attr("data-target")]?1:0)})}function storeSettings(){$.cookie("settings",JSON.stringify(_SETTINGS),{expires:365})}function loadMessages(){$.ajax({url:"json/messages.json?"+$.now(),dataType:"json",complete:function(e){if(null!=e&&null!=e.responseJSON)for(var t in e.responseJSON){var a=e.responseJSON[t];setMessage("<strong>"+a.title+"</strong><br />"+a.message,a.level)}}})}function handlePageSwitch(e){e="#"+e.split("#")[1],$("div.branding-container, ul.nav-pills>li").removeClass("active"),$('.branding[href="'+e+'"], ul.nav-pills>li>a[href="'+e+'"]').parent().addClass("active")}function checkDarkmode(){var e=_SETTINGS.darkmode,t=$('link[name="bootstrap"]'),a=$(t).attr("href");e?(a.includes(".dark.")||($(t).after($(t).clone().attr("href",a.replace(".light.",".dark."))),$(t).remove()),$("body").addClass("darkmode"),$("body").removeClass("lightmode"),$("html").attr("mode","darkmode")):(a.includes(".dark.")&&($(t).after($(t).clone().attr("href",a.replace(".dark.",".light."))),$(t).remove()),$("body").removeClass("darkmode"),$("body").addClass("lightmode"),$("html").attr("mode","lightmode"))}function checkTips(){checkCopyStatsTip(),checkTimezonesTip(),checkRangeselectionTip()}function checkCopyStatsTip(){_SETTINGS.dismissed_objects.includes("tip_copystats")||$("#information-addon-copystats").removeClass("hidden")}function checkTimezonesTip(){_SETTINGS.dismissed_objects.includes("tip_timezones")||$("#information-addon-timezones").removeClass("hidden")}function checkRangeselectionTip(){_SETTINGS.dismissed_objects.includes("tip_timerangeselection")||$("#information-addon-time-range-selection").removeClass("hidden")}function toggleNightmode(){var e=_SETTINGS.darkmode;_SETTINGS.darkmode=!e,storeSettings(),checkDarkmode()}function setView(e){$("#matchlist").addClass("hidden"),$("#match").addClass("hidden"),$("#world-ranking").addClass("hidden"),$("#legal-notice").addClass("hidden"),$("#timezones").addClass("hidden"),$("#matchlist-search").val(""),$("div.header").addClass("disabled"),e==ENUM_VIEW.NONE?($("body").children(".fixedHeader").each(function(){$(this).remove()}),null!=m_oDataTableRanking&&(m_oDataTableRanking.clear(),m_oDataTableRanking.destroy(),m_oDataTableRanking=null)):e==ENUM_VIEW.MATCH?$("#match").removeClass("hidden"):e==ENUM_VIEW.MATCHLIST?$("#matchlist").removeClass("hidden"):e==ENUM_VIEW.WORLD_RANKING?$("#world-ranking").removeClass("hidden"):e==ENUM_VIEW.LEGAL?$("#legal-notice").removeClass("hidden"):e==ENUM_VIEW.TIMEZONES&&$("#timezones").removeClass("hidden"),$("div.header").removeClass("disabled")}function getMaps(e){var t=new Array;return t[38]="Eternal Battlegrounds",t[94]=e.red+" Borderlands",t[95]=e.green+" Borderlands",t[96]=e.blue+" Borderlands",t[1099]=e.red+" Borderlands",t}function getMapClasses(){var e=new Array;return e[38]="ebg",e[94]="red",e[95]="green",e[96]="blue",e[1099]="red",e}function getWorlds(e){var t=new Array;for(var a in t.red=null,t.green=null,t.blue=null,_WORLDS={},e.series){var s=e.series[a];t[s.color]=s.world_name,_WORLDS[s.color]={name:s.world_name,id:s.world_arenanet_id}}return t}function resolveSlug(e,t){$.ajax({url:_API_BASE+"slug/"+e+"?ts="+$.now(),caching:!1,dataType:"json",complete:function(e){null!=e&&null!=e.responseJSON?t(e.responseJSON):t(null)},error:function(e,t,a){setMessage("<b>"+t+"</b><br />"+a,"danger"),setView(ENUM_VIEW.MATCHLIST)}})}function setSpecificMatch(e){setLoading(!0),setView(ENUM_VIEW.NONE),setMatch(e)}function setTimezones(){setView(ENUM_VIEW.NONE),setLoading(!0),$.ajax({url:_API_BASE+"timezones?ts="+$.now(),dataType:"json",complete:function(e){var t='<ul class="media-list">';for(var a in e.responseJSON.matches){var s=e.responseJSON.matches[a],r="1"==s.current_match.arenanet_id.split("-")[0]?"NA":"EU",o=s.current_match.arenanet_id.split("-")[1];for(var i in t+='<li class="media"><div class="pull-left"><div class="timezones-eyecatcher media-object"><span class="timezones-region region-'+r.toLowerCase()+'">'+r+'</span><span class="timezones-tier">Tier '+o+'</span></div></div>  <div class="media-body">',s.worlds){var l=s.worlds[i];for(var n in t+='<div class="row">',t+='<div class="col-md-4"><i class="famfamfam-flag-'+getFlagShort(l.linking.host_world.arenanet_id)+'"></i> <strong>'+l.linking.host_world.name+"</strong>",l.linking.partner_worlds){var d=l.linking.partner_worlds[n];t+=', <i class="famfamfam-flag-'+getFlagShort(d.arenanet_id)+'"></i> '+d.name}var c=86400,m=moment.utc(l.timezone.start_time,"HH:mm:ss").local().diff(moment().startOf("day"),"seconds"),p=moment.utc(l.timezone.end_time,"HH:mm:ss").local().diff(moment().startOf("day"),"seconds");if(m<0&&(m=moment.utc(l.timezone.start_time,"HH:mm:ss").local().diff(moment().subtract(1,"days").startOf("day"),"seconds")),p<0)p=moment.utc(l.timezone.end_time,"HH:mm:ss").local().diff(moment().subtract(1,"days").startOf("day"),"seconds");var _=0;p>c&&(_=p-c,p=c);var h=(m-_)/c*100,g=(p-m)/c*100,u=_/c*100,S=100-u-h-g,f=moment.duration(p-m+_+1,"seconds"),v=f.hours()+"h "+(f.minutes()>0?f.minutes()+"m":""),T="red"==i?"progress-bar-danger":"green"==i?"progress-bar-success":"";console.log(m+"/"+p+":"+h+"/"+g);var w="Primetime: "+moment.utc(l.timezone.start_time,"HH:mm:ss").local().format("HH:mm")+" to "+moment.utc(l.timezone.end_time,"HH:mm:ss").local().format("HH:mm")+"\r\n"+l.timezone.kill_percentage.toFixed(1)+"% of daily kills \r\n"+l.timezone.death_percentage.toFixed(1)+"% of daily deaths",C="";1==l.timezone.activity_rank_in_region&&(C='<span class="timezone-hint timezone-hint-activity" data-container="body" data-toggle="tooltip" data-placement="top" title="Most active primetime in '+r+" with "+l.timezone.activity_per_minute.toFixed(2)+' kills/deaths per minute" ><i class="icon icon-badge-gold-small"></i> Top Activity in '+r+"</span>"),1==l.timezone.kdr_rank_in_region&&(C+='<span class="timezone-hint timezone-hint-kdr" data-container="body" data-toggle="tooltip" data-placement="top" title="Strongest KDR primetime in '+r+": "+getKdr(l.timezone.kills,l.timezone.deaths)+' KDR" ><i class="icon icon-badge-kdr-small"></i> Top KDR in '+r+"</span>");var b="",k="";h>S?b=C:k=C,t+='</div><div class="col-md-8"><div class="progress"><div class="progress-bar-early progress-bar '+T+'" role="progressbar" style="width:'+u+'%;"></div><div class="progress-bar progress-bar-transparent progressbar-before-range" role="progressbar" style="width:'+h+'%;">'+b+'</div><div class="progress-bar progress-bar-timezone '+T+'" data-container="body"  role="progressbar" data-toggle="tooltip" data-placement="top" title="'+w+'" style="width:'+g+'%;">'+v+'</div> <div class="progress-bar progress-bar-transparent progressbar-after-range" role="progressbar" style="width:'+S+'%;">'+k+"</div></div></div>",t+="</div>"}t+="</div></li>"}t+="</ul>",$("#timezones-container").html(t),$("#timezones-last-updated").html("Last updated at "+moment.utc(e.responseJSON.last_update).local().format("HH:mm:ss")+" ("+moment.utc(e.responseJSON.last_update).local().fromNow()+")"),$("#timezones-max-timeslots").text(e.responseJSON.count_timeslots_max),$('[data-toggle="tooltip"]').tooltip(),setView(ENUM_VIEW.TIMEZONES),setLoading(!1)},error:function(e,t,a){setMessage("<b>"+t+"</b><br />"+a,"danger")}})}function setWorldRanking(){setView(ENUM_VIEW.NONE),setLoading(!0),$.ajax({url:_API_BASE+"worldranking?ts="+$.now(),dataType:"json",complete:function(e){for(var t in m_oDataTableRanking=$("#table-world-ranking").DataTable({order:[[6,"desc"]],paging:!1,info:!1,searching:!0,columnDefs:[{type:"percent",targets:7}]}),e.responseJSON){var a=e.responseJSON[t];for(var s in a.linkings){var r=a.linkings[s],o="",i=0;for(var l in r.partners)0==i&&(o+=", "),o+='<br /><i class="famfamfam-flag-'+getFlagShort(r.partners[l].arenanet_id)+'"></i> '+r.partners[l].name,i++,i<r.partners.length&&(o+=", ");var n='<i class="famfamfam-flag-'+getFlagShort(a.arenanet_id)+'"></i> <b>'+a.name+"</b>";m_oDataTableRanking.row.add([n+o,r.matchcount.toString(),r.kills.toThousandSeparator(),r.deaths.toThousandSeparator(),(r.kills/r.matchcount).toFixed(2).toString(),(r.deaths/r.matchcount).toFixed(2).toString(),getKdr(r.kills,r.deaths),r.score>0?(r.kills*r.ppk_value/r.score*100).toFixed(2)+"%":"n/a"]).draw(!1)}}setView(ENUM_VIEW.WORLD_RANKING),setLoading(!1),new $.fn.dataTable.FixedHeader(m_oDataTableRanking,{})},error:function(e,t,a){setMessage("<b>"+t+"</b><br />"+a,"danger")}})}function setAllMatchlist(){var e="#matchlist-container";setLoading(!0),$(e).html(""),resetView(),setView(ENUM_VIEW.NONE),$.ajax({url:_API_BASE+"matchlist/all?ts="+$.now(),dataType:"json",complete:function(t){setView(ENUM_VIEW.NONE);var a="";for(var s in t.responseJSON){var r=t.responseJSON[s],o=moment.utc(r.start).format("YYYY.MM.DD");o!=a&&($(e).append("<h2>"+moment.utc(r.start).local().format("YYYY.MM.DD")+" - "+moment.utc(r.end).local().format("YYYY.MM.DD")+"</h2></div>"),a=o),displayMatchlistMatchContainer(e,s,r)}setLoading(!1),setView(ENUM_VIEW.MATCHLIST)},error:function(e,t,a){setMessage("<b>"+t+"</b><br />"+a,"danger")}})}function setCurrentMatchlistMainMenu(){var e="#menu-current-matchups";$.ajax({url:_API_BASE+"matchlist/current?ts="+$.now(),dataType:"json",complete:function(t){for(var a in t.responseJSON){var s=t.responseJSON[a],r=s.arenanet_id.split("-")[1],o="1"==s.arenanet_id.split("-")[0]?"NA":"EU",i="#/matches/"+getLongestInArray(s.slugs)+"/";$(e).append('<li data-match-id="'+s.id+'" id="menu-'+a+'"></li>');var l='<a href="'+i+'"><b>'+o+"</b>/<b>T"+r+"</b> ",n=0;for(var d in s.worlds){var c=s.worlds[d];n>0&&(l+=" - "),l+='<i class="famfamfam-flag-'+getFlagShort(c.arenanet_id)+'"></i> ',l+=c.name,n++}l+="</a>",$("#menu-"+a).append(l),$("#menu-"+a).click(function(){$("#current-matches-dropdown").dropdown("toggle")})}},error:function(e,t,a){setMessage("<b>"+t+"</b><br />"+a,"danger")}})}function setCurrentMatchlist(){var e="#matchlist-container";$(e).html(""),setView(ENUM_VIEW.NONE),setLoading(!0),$.ajax({url:_API_BASE+"matchlist/current?ts="+$.now(),dataType:"json",complete:function(t){for(var a in setView(ENUM_VIEW.NONE),t.responseJSON)displayMatchlistMatchContainer(e,a,t.responseJSON[a]);setLoading(!1),setView(ENUM_VIEW.MATCHLIST)},error:function(e,t,a){setMessage("<b>"+t+"</b><br />"+a,"danger")}})}function displayMatchlistMatchContainer(e,t,a){var s=a.arenanet_id.split("-")[1],r="1"==a.arenanet_id.split("-")[0]?"NA":"EU",o=m_bDebug?t:"",i=new Array;i.push("T"+s),i.push("Tier"+s),i.push(r),i.push(a.start),i.push(a.end),i.push(moment(a.start).format("YYYY.MM.DD")),i.push(moment(a.end).format("YYYY.MM.DD"));var l="#/matches/"+getLongestInArray(a.slugs)+"/";$(e).append('<div id="'+t+'" class="list-group-item '+r.toLowerCase()+'"><div class="row"><div class="col-md-1"><div class="matchlist-eyecatcher"><span class="matchlist-region region-'+r.toLowerCase()+'">'+r+'</span><span class="matchlist-tier">Tier '+s+'</span></div></div><div class="col-md-9"><a class="match-container" data-match-id="'+a.id+'"></a></div><div class="col-md-2"><span class="matchlist-last-update pull-right" title="'+moment.utc(a.last_update).local().format("HH:mm:ss")+'">updated '+moment.utc(a.last_update).local().fromNow()+"</span>"+o+"</div></div></div>");var n='<div class="matchlist-worldlist">',d="",c=new Array;for(var m in c.push(a.worlds.green),c.push(a.worlds.blue),c.push(a.worlds.red),c){var p=c[m],_=parseInt(p.kills)/parseInt(p.deaths),h=_>=1?"success":1==_.toFixed(2)?"warning":"danger",g=a.has_score_data?2:1,u=a.has_score_data?7:8;if(n+='<div class="row"><div class="col-md-'+g+' matchlist-world-kd">',n+='<span title="Kills: '+p.kills+" / Deaths: "+p.deaths+'" class="label label-'+h+'">KD: '+getKdr(p.kills,p.deaths)+"</span>",a.has_score_data){var S=a.ppk_value*p.kills,f=S/p.score*100,v=getClassForMatchlistPpkRanking(c,p,a);n+='<span title="Total score: '+p.score.toThousandSeparator()+'" title="" class="label label-'+v+' label-ppk-percentage">'+f.toFixedLeading(2,2)+"% PPK</span>"}var T=getWidths(parseInt(p.kills),parseInt(p.deaths));if(n+='</div><div class="col-md-3 matchlist-stat-container"><div class="progress"><div class="progress-bar kills total '+p.world_id+' no-nightmode" title="kills" role="progressbar" style="width: '+T.kills+"; background-color: "+shadeColor(colorNameToHex(p.color),.3)+';"  >'+p.kills+'</div><div class="progress-bar '+p.world_id+' total deaths no-nightmode" style="width: '+T.deaths+"; background-color: "+shadeColor(colorNameToHex(p.color),-.3)+';" title="deaths">'+p.deaths+'</div></div></div><div class="col-md-'+u+' matchlist-world-container"><b><i class="famfamfam-flag-'+getFlagShort(p.arenanet_id)+'"></i> '+p.name+"</b>",i.push(p.name),null!=p.additional_worlds)for(var w in p.additional_worlds)n+=', <i class="famfamfam-flag-'+getFlagShort(p.additional_worlds[w].arenanet_id)+'"></i> '+p.additional_worlds[w].name,i.push(p.additional_worlds[w].name);n+="</div></div>"}n+="</a></div>",$("#"+t+" a.match-container").append(n),$("#"+t+" div.matchlist-stat-container").append(d),$("#"+t).attr("data-search-query",i.join("#")),$("#"+t+" a.match-container").click(function(){window.location=l})}function getClassForMatchlistPpkRanking(e,t,a){var s=e.slice(0).sort(function(e,t){var s=a.ppk_value*e.kills,r=s/e.score*100,o=a.ppk_value*t.kills,i=o/t.score*100;return i-r});return s[0]==t?"success":s[s.length-2]==t?"warning":s[s.length-1]==t?"danger":"default"}function getClassForWorldStatisticsPpkRanking(e,t){var a=e.slice(0).sort(function(e,t){var a=0,s=0,r=0,o=0;for(var i in e.maps){var l=e.maps[i];a+=l.kills,s+=l.score}for(var i in t.maps){l=t.maps[i];r+=l.kills,o+=l.score}var n=_CURRENT_MATCH.ppk_value*a,d=n/s*100,c=_CURRENT_MATCH.ppk_value*r,m=c/o*100;return m-d});return a[0].world_id==t.world_id?"success":a[a.length-2].world_id==t.world_id?"warning":a[a.length-1].world_id==t.world_id?"danger":"default"}function getClassForMapPpkRanking(e,t){var a=Object.values(e),s=a.slice(0).sort(function(e,t){var a=_CURRENT_MATCH.ppk_value*e.kills,s=a/e.score*100,r=_CURRENT_MATCH.ppk_value*t.kills,o=r/t.score*100;return o-s});return s[0].map_id==t.map_id?"success":s[s.length-1].map_id==t.map_id?"danger":"default"}function setMatch(e){setView(ENUM_VIEW.NONE),setLoading(!0),resetView(),m_oHighchartsKills=new Highcharts.stockChart(getChartOptions());var t=_SETTINGS.flattening?"flattened":"unaltered",a=_SETTINGS.smoothing?"smoothed":"unaltered";$.ajax({url:_API_BASE+"match/"+e+"/"+t+"/"+a+"?ts="+$.now(),dataType:"json",complete:function(t){var a=t.responseJSON,s=0,r=getWorlds(a),o=getMaps(r),i=0,l=0;_CURRENT_MATCH=a;var n=a.match_arenanet_id.split("-")[1],d="1"==a.match_arenanet_id.split("-")[0]?"NA":"EU",c=getLongestInArray(a.slugs);$("div#match > a.get-shortlink").attr("data-match-slug",c),$("#match-title").html(moment(a.match_start).format("YYYY.MM.DD")+" - "+moment(a.match_end).format("YYYY.MM.DD")+" <small>"+d+" Tier "+n+"</small>"),$("#match-last-update").html("Last updated at "+moment.utc(a.last_update).local().format("HH:mm:ss")+" ("+moment.utc(a.last_update).local().fromNow()+")"),m_oHighchartsKills.setTitle({text:r.green+" / "+r.blue+" / "+r.red}),$("#disable-flattening").addClass("hidden"),$("#enable-flattening").addClass("hidden"),a.flattening_requested&&a.flattened?$("#disable-flattening").removeClass("hidden"):a.flattening_requested||$("#enable-flattening").removeClass("hidden"),_SETTINGS.range_selection&&(_CURRENT_SELECTED_RANGE.min=a.match_start,_CURRENT_SELECTED_RANGE.max=a.match_end);var m=0,p=a.series[Object.keys(a.series)[0]];for(var _ in p.series_items){p.series_items[_];var h=0,g=0;for(var u in a.series)oSeries=a.series[u],h+=parseInt(oSeries.series_items[m].kills),g+=parseInt(oSeries.series_items[m].deaths);h>i&&(i=h),g>l&&(l=g),m++}var S=i;for(var u in l>S&&(S=l),l*=-1,m_oHighchartsKills.yAxis[0].update({min:-1*S-100,max:0}),m_oHighchartsKills.yAxis[1].update({min:0,max:S+100}),a.series)setSeries(a.series[u],r,o,s,"Kills"),s++;for(var u in a.series)setSeries(a.series[u],r,o,s,"Deaths"),s++;_CURRENT_MATCH_ID=e,(a.flattened||a.smoothed)&&setMessage("Due to the <strong>Guild Wars 2 API</strong>'s timing issues the data of this match has been flattened to be more precise.<br />Please note, that this has altered the timeline of when kills occured, while the kill and death counts remain correct. I know it's not pretty, but that's as much as i can do ðŸ”¥.","warning"),setStatisticsView(a),initMatchStatistics(a),setStatistics(-1),m_oHighchartsKills.redraw(),setLoading(!1),setView(ENUM_VIEW.MATCH)},error:function(e,t,a){setMessage("<b>"+t+"</b><br />"+a,"danger")}})}function setStatisticsView(e){for(var t in _STATISTICS_VIEW={worlds:{},timeslots:{},start:null,end:null},e.series){var a=e.series[t],s=a.map_id,r=a.world_arenanet_id;for(var o in _STATISTICS_VIEW.worlds[r]||(_STATISTICS_VIEW.worlds[r]={world_name:a.world_name,world_id:a.world_arenanet_id,color:a.color,maps:{}}),_STATISTICS_VIEW.worlds[r].maps[s]||(_STATISTICS_VIEW.worlds[r].maps[s]={map_id:a.map_id,kills:0,deaths:0,score:0}),a.series_items){var i=a.series_items[o],l=i.timeslot_id.toString();null==_STATISTICS_VIEW.start&&(_STATISTICS_VIEW.start=i.timeslot_start),_STATISTICS_VIEW.end=i.timeslot_end,_STATISTICS_VIEW.timeslots[l]||(_STATISTICS_VIEW.timeslots[l]={timeslot_id:i.timeslot_id,timeslot_start:i.timeslot_start,timeslot_end:i.timeslot_end,worlds:{}}),_STATISTICS_VIEW.timeslots[l].worlds[r]||(_STATISTICS_VIEW.timeslots[l].worlds[r]={world_name:a.world_name,world_id:a.world_arenanet_id,color:a.color,maps:{}}),_STATISTICS_VIEW.timeslots[l].worlds[r].maps[s]||(_STATISTICS_VIEW.timeslots[l].worlds[r].maps[s]={map_id:a.map_id,kills:0,deaths:0,score:0}),_STATISTICS_VIEW.worlds[r].maps[s].kills+=parseInt(i.kills),_STATISTICS_VIEW.worlds[r].maps[s].deaths+=parseInt(i.deaths),_STATISTICS_VIEW.worlds[r].maps[s].score+=parseInt(i.score_gain),_STATISTICS_VIEW.timeslots[l].worlds[r].maps[s].kills+=parseInt(i.kills),_STATISTICS_VIEW.timeslots[l].worlds[r].maps[s].deaths+=parseInt(i.deaths),_STATISTICS_VIEW.timeslots[l].worlds[r].maps[s].score+=parseInt(i.score_gain)}}}function setMessage(e,t){$("#message-container").append('<div class="alert alert-'+t+' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+e+"</div>")}function clearMessages(){$("#message-container").html("")}function setSeries(e,t,a,s,r){var o="Deaths"==r;for(var i in m_oHighchartsKills.addSeries({name:"["+r+"] "+e.world_name+" on "+a[e.map_id],yAxis:o?0:1,animation:!1,type:"area",step:"center",color:getMapChartColor(e.color,e.map_id,o)}),e.series_items){var l=e.series_items[i],n=o?-1*parseInt(l.deaths):parseInt(l.kills),d=null;l.flattened&&0==s&&(d={symbol:"url(img/warning_marker.png)"}),m_oHighchartsKills.series[s].addPoint({x:Date.parse(moment.utc(l.timeslot_start).local().format()),y:n,name:"<strong>"+moment.utc(l.timeslot_start).local().format("YYYY/MM/DD | dddd")+"</strong><br />"+moment.utc(l.timeslot_start).local().format("HH:mm:ss ")+" to "+moment.utc(l.timeslot_end).local().format("HH:mm:ss "),world:e.world_arenanet_id,map:e.map_id,kills:parseInt(l.kills),deaths:parseInt(l.deaths),flattened:l.flattened,timeslot_id:l.timeslot_id,seriesindex:s,marker:d},!1)}}function initMatchStatistics(e){var t="#match-statistics-container",a=new Array,s=getMapClasses(),r=e.has_score_data?6:8,o=e.has_score_data?4:2,i=e.has_score_data?" has-score-data":"";for(var l in $(t).html(""),e.series){var n=e.series[l],d=n.world_arenanet_id;void 0===a[d]&&(a[d]={world_id:n.world_arenanet_id,color:n.color,world_name:n.world_name,maps:new Array}),a[d].maps[n.map_id]={map_id:n.map_id}}var c='<div class="row'+i+'">';for(var m in a){oWorld=a[m],c+='<div class="col-md-4 world-container '+oWorld.world_id+'" data-world-name="'+oWorld.world_name+'">',c+='<div class="row"><div class="col-md-9"><h4>'+oWorld.world_name+'</h4><span class="copy-statistics copy-'+oWorld.world_id+'" title="Copy statistics to clipboard"><i class="glyphicon glyphicon-copy"></i></span></div><div class="col-md-3"><h4 class=" world-kd '+oWorld.world_id+'"></h4></div></div><h6>';var p=0;for(var _ in e.worlds[oWorld.color].additional_worlds)p++,c+=e.worlds[oWorld.color].additional_worlds[_].name,p<Object.keys(e.worlds[oWorld.color].additional_worlds).length&&(c+=", ");for(var h in c+="&nbsp;</h6>",oWorld.maps){var g=oWorld.maps[h],u="38"==g.map_id?"EBG":"Border";c+='<div class="row kd" data-world="'+oWorld.world_id+'" data-map-id="'+h+'" data-color="'+s[g.map_id]+'" data-world-name="'+oWorld.world_name+'" data-map-name="'+u+'">',c+='<div class="col-md-2 col-map-name map-name-'+s[g.map_id]+'">'+u+'</div><div class="col-md-'+r+' col-world-kills"><div class="progress"><div class="progress-bar '+h+" "+oWorld.world_id+' kills no-nightmode" title="kills" role="progressbar" style="width: 50%; background-color: '+getMapChartColor(oWorld.color,g.map_id,!1)+';"  ></div><div class="progress-bar '+h+" "+oWorld.world_id+' deaths no-nightmode" style="width: 50%; background-color: '+getMapChartColor(oWorld.color,g.map_id,!0)+';" title="deaths"></div></div></div><div class="col-md-'+o+" "+h+" "+oWorld.world_id+" "+i+' kdr col-kdr"></div></div>'}c+='<div class="row kd-total" data-world="'+oWorld.world_id+'"><div class="col-md-2 col-world-name"><strong>Total</strong></div><div class="col-md-'+r+' col-world-kills"><div class="progress"><div class="progress-bar kills total '+oWorld.world_id+'  no-nightmode" title="kills" role="progressbar" style="width: 50%; background-color: '+shadeColor(colorNameToHex(oWorld.color),.3)+';"  ></div><div class="progress-bar '+oWorld.world_id+' total deaths no-nightmode" style="width: 50%; background-color: '+shadeColor(colorNameToHex(oWorld.color),-.3)+';" title="deaths"></div></div></div><div class="col-md-'+o+" col-kdr"+i+'"><strong><span class="kdr total '+oWorld.world_id+' "></span></strong></div></div>',c+="</div>"}for(var m in c+="</div>",$(t).append(c),$("span.copy-statistics").click(function(){$(this).addClass("highlight"),setTimeout(function(){$(".highlight").removeClass("highlight")},1e3)}),a)$(".copy-"+a[m].world_id).attr("data-clipboard-text",getClipboard(e,a[m].world_id,null)),new Clipboard(".copy-"+a[m].world_id)}function setStatistics(e){if($("#match-current-range-selection").addClass("hidden"),-1==e){if(_SETTINGS.range_selection){var t=getStatisticsContainerForTimeRange(_CURRENT_MATCH);for(var a in $("#match-current-range-selection").removeClass("hidden"),$("#match-current-range-selection").text("Current Selection: "+moment.utc(t.start).local().format("YYYY.MM.DD HH:mm")+" to "+moment.utc(t.end).local().format("YYYY.MM.DD HH:mm")),t.worlds){var s=t.worlds[a];setStatisticForWorld(s,t.worlds)}}else for(var a in _STATISTICS_VIEW.worlds){s=_STATISTICS_VIEW.worlds[a];setStatisticForWorld(s,_STATISTICS_VIEW.worlds)}for(var a in _STATISTICS_VIEW.worlds){s=_STATISTICS_VIEW.worlds[a];$(".copy-"+s.world_id).attr("data-clipboard-text",getClipboard(_CURRENT_MATCH,s.world_id,null)),new Clipboard(".copy-"+s.world_id)}}else for(var a in _STATISTICS_VIEW.timeslots[e].worlds){s=_STATISTICS_VIEW.timeslots[e].worlds[a];setStatisticForWorld(s,_STATISTICS_VIEW.timeslots[e].worlds)}}function getStatisticsContainerForTimeRange(e){var t={worlds:{},start:null,end:null};for(var a in e.series){var s=e.series[a],r=s.map_id,o=s.world_arenanet_id;for(var i in t.worlds[o]||(t.worlds[o]={world_name:s.world_name,world_id:s.world_arenanet_id,color:s.color,maps:{}}),t.worlds[o].maps[r]||(t.worlds[o].maps[r]={map_id:s.map_id,kills:0,deaths:0,score:0}),s.series_items){var l=s.series_items[i];Date.UTC(l.timeslot_start),Date.UTC(l.timeslot_end);moment(_CURRENT_SELECTED_RANGE.min).isSameOrBefore(moment.utc(l.timeslot_start))&&moment(_CURRENT_SELECTED_RANGE.max).isSameOrAfter(moment.utc(l.timeslot_start))&&(null==t.start&&(t.start=l.timeslot_start),t.end=l.timeslot_end,t.worlds[o].maps[r].kills+=parseInt(l.kills),t.worlds[o].maps[r].deaths+=parseInt(l.deaths),t.worlds[o].maps[r].score+=parseInt(l.score_gain))}}return t}function setStatisticForWorld(e,t){var a=0,s=0,r=0;for(var o in e.maps){var i=e.maps[o],l=getWidths(i.kills,i.deaths),n=parseInt(i.kills)/parseInt(i.deaths),d=n>=1?"success":1==n.toFixed(2)?"warning":"danger";if($(".progress-bar."+e.world_id+"."+i.map_id+".kills").css("width",l.kills).text(i.kills),$(".progress-bar."+e.world_id+"."+i.map_id+".deaths").css("width",l.deaths).text(i.deaths),$(".kdr."+e.world_id+"."+i.map_id).html('<span class="label label-'+d+'">&empty; '+getKdr(i.kills,i.deaths)+"</span>"),_CURRENT_MATCH.has_score_data){var c=_CURRENT_MATCH.ppk_value*i.kills,m=i.score>0?c/i.score*100:0,p=getClassForMapPpkRanking(e.maps,i);$(".kdr."+e.world_id+"."+i.map_id).append('<span title="Total score: '+i.score.toThousandSeparator()+'" class="label-ppk-percentage label label-'+p+' label-ppk-percentage">'+m.toFixedLeading(2,2)+"% PPK</span>")}a+=i.kills,s+=i.deaths,r+=i.score}var _=getWidths(a,s);n=a/s,d=n>=1?"success":1==n.toFixed(2)?"warning":"danger";if($(".progress-bar."+e.world_id+".total.kills").css("width",_.kills).text(a),$(".progress-bar."+e.world_id+".total.deaths").css("width",_.deaths).text(s),$(".world-kd."+e.world_id).html("&empty;"+getKdr(a,s)),$(".kdr.total."+e.world_id).html('<span class="label label-'+d+'">&empty; '+getKdr(a,s)+"</span>"),_CURRENT_MATCH.has_score_data){c=_CURRENT_MATCH.ppk_value*a,m=r>0?c/r*100:0,p=getClassForWorldStatisticsPpkRanking(Object.values(t),e);$(".kdr.total."+e.world_id).append('<span title="Total score: '+r.toThousandSeparator()+'" class="label-ppk-percentage label label-'+p+' label-ppk-percentage">'+m.toFixedLeading(2,2)+"% PPK</span>")}}function getClipboard(e,t,a){var s=_STATISTICS_VIEW.worlds[t],r=null,o="";null!=a&&a?(s=_STATISTICS_VIEW.timeslots[a].worlds[t],o=" ("+moment.utc(_STATISTICS_VIEW.timeslots[a].timeslot_start).local().format("HH:mm")+"-"+moment.utc(_STATISTICS_VIEW.timeslots[a].timeslot_end).local().format("HH:mm")+")"):_SETTINGS.range_selection&&(r=getStatisticsContainerForTimeRange(e),o=" ("+moment.utc(r.start).local().format("YYYY.MM.DD HH:mm")+"-"+moment.utc(r.end).local().format("YYYY.MM.DD HH:mm")+")",s=r.worlds[t]);var i=0,l=0,n=0,d=getMapClasses(),c=new Array;for(var m in s.maps){var p=s.maps[m],_=parseInt(p.kills),h=parseInt(p.deaths),g="38"==p.map_id?"EBG":"",u=d[p.map_id];i+=h,l+=_,n+=p.score;var S="";if(_CURRENT_MATCH.has_score_data){var f=p.score>0?p.kills*_CURRENT_MATCH.ppk_value/p.score*100:0;S+=", "+f.toFixed(0)+"%"}var v=getKdr(_,h)+" kd ("+_+"/"+h+S+") @ ";"ebg"!=u&&(v+=u.toProperCase()),v+=g,c.push(v)}S="";if(_CURRENT_MATCH.has_score_data){f=n>0?l*_CURRENT_MATCH.ppk_value/n*100:0;S+=", "+f.toFixed(0)+"% PPK"}var T=s.world_name.split("[")[0].trim()+o+": "+getKdr(l,i)+" kd ("+l+"/"+i+S+") | ";return trimClipboard(T+c.join(" | ")+" - "+moment.utc(e.last_update).local().fromNow())}function trimClipboard(e){const t=199;return e.length>t&&(e=e.replace("@ Green","@GBL"),e=e.replace("@ Red","@RBL"),e=e.replace("@ Blue","@GBL"),e=e.replace("@ EBG","@EB")),e.length>t&&(e=e.replace(" - a minute ago"," - now"),e=e.replace(" - a few seconds ago"," - now"),e=e.replace(" minutes ago"," min. ago")),e.length>t&&(e=e.replace("Blackgate","BG"),e=e.replace("Jade Quarry","JQ"),e=e.replace("Sanctum of Rall","SoR"),e=e.replace("Ehmry Bay","Eh.B"),e=e.replace("Stormbluff Isle","SbI"),e=e.replace("Borlis Pass","Bor.Pa."),e=e.replace("Tarnished Coast","Tar.Co."),e=e.replace("Crystal Desert","Cr.Des."),e=e.replace("Dragonbrand","Drag.Br."),e=e.replace("Darkhaven","Da.Hav."),e=e.replace("Maguuma","Mag."),e=e.replace("Isle of Janthir","Isl.o.Ja."),e=e.replace("Sea of Sorrows","SoS"),e=e.replace("Devona's Rest","Dev.R"),e=e.replace("Fort Aspenwood","FA"),e=e.replace("Northern Shiverpeaks","NSP"),e=e.replace("Sorrow's Furnace","SF"),e=e.replace("Henge of Denravi","HoD"),e=e.replace("Yak's Bend","YB"),e=e.replace("Anvil Rock","AR"),e=e.replace("Gate of Madness","GoM"),e=e.replace("Desolation","Deso"),e=e.replace("Arborstone","Arb.St."),e=e.replace("Far Shiverpeaks","FSP"),e=e.replace("Ring of Fire","RoF"),e=e.replace("Gunnar's Hold","GH"),e=e.replace("Fissure of Woe","FoW"),e=e.replace("Aurora Glade","AG"),e=e.replace("Fort Ranik","FR"),e=e.replace("Baruch Bay","BB"),e=e.replace("Underworld","UW"),e=e.replace("Drakkar Lake","Drakkar"),e=e.replace("Piken Square","Piken"),e=e.replace("Blacktide","BT"),e=e.replace("Seafarer's Rest","SFR"),e=e.replace("Abaddon's Mouth","Aba"),e=e.replace("Riverside","RS"),e=e.replace("Elona Reach","Elona"),e=e.replace("Miller's Sound","Miller"),e=e.replace("Jade Sea","JS"),e=e.replace("Vizunah Square","Vizu"),e=e.replace("Whiteside Ridge","WSR"),e=e.replace("Augury Rock","AR"),e=e.replace("Ruins of Surmia","RoS"),e=e.replace("Dzagonur","Dzago")),e.length>t&&(e=e.replaceAll(" kd ",""),e=e.replaceAll("% PPK","%PPK")),e.length>t&&(e=e.replaceAll(" @","@"),e=e.replaceAll(" |","|")),e.trim()}function resetView(){null!=m_oHighchartsKills&&null!=m_oHighchartsKills&&(m_oHighchartsKills.destroy(),m_oHighchartsKills=void 0,$("main-chart-container").html("")),_STATISTICS_VIEW=null,_CURRENT_MATCH=null}function getFlagShort(e){var t=e.toString().substring(0,2);switch(t){case"10":return"us";case"20":return"eu";case"21":return"fr";case"22":return"de";case"23":return"es"}}function setLoading(e){$("#loading-container").removeClass("hidden"),e?clearMessages():$("#loading-container").addClass("hidden")}function getChartOptions(){var e="main-chart-container";Highcharts.setOptions({global:{useUTC:!1}});var t={chart:{backgroundColor:"transparent",renderTo:e,height:500,zoomType:"xy",spacingLeft:0,spacingRight:0},rangeSelector:{enabled:!1},scrollbar:{liveRedraw:!1},navigator:{adaptToUpdatedData:!1},xAxis:{type:"datetime",labels:{align:"left",formatter:function(){var e=moment.utc(this.value).add(15,"minutes").local().format("HH:mm");return e}},events:{setExtremes:function(e){_CURRENT_SELECTED_RANGE.min=new Date(e.min),_CURRENT_SELECTED_RANGE.max=new Date(e.max),setStatistics(-1)}}},title:{text:" "},yAxis:[{allowDecimals:!1,title:{text:"deaths"},opposite:!0,gridLineWidth:0,visible:!1,labels:{formatter:function(){return Math.abs(this.value)}}},{allowDecimals:!1,opposite:!0,gridLineWidth:0,labels:{formatter:function(){return Math.abs(this.value)}}}],plotOptions:{series:{animation:!1},area:{stacking:"normal",animation:!1,marker:{},point:{events:{click:function(){setCopyModal(this.timeslot_id)}}}}},series:[]};return t}function setCopyModal(e){$("#copy-timeslot-green").attr("data-timeslot-id",e),$("#copy-timeslot-blue").attr("data-timeslot-id",e),$("#copy-timeslot-red").attr("data-timeslot-id",e),$("#copy-timeslot-green-name").text(_WORLDS.green.name),$("#copy-timeslot-green").attr("data-world-id",_WORLDS.green.id),$("#copy-timeslot-blue-name").text(_WORLDS.blue.name),$("#copy-timeslot-blue").attr("data-world-id",_WORLDS.blue.id),$("#copy-timeslot-red-name").text(_WORLDS.red.name),$("#copy-timeslot-red").attr("data-world-id",_WORLDS.red.id),$("#copy-timeslot").css("top",_CURSOR.y).css("left",_CURSOR.x-30);var t=_STATISTICS_VIEW.timeslots[e];$("#copy-timeslot-header").html(moment.utc(t.timeslot_start).local().format("HH:mm")+"-"+moment.utc(t.timeslot_end).local().format("HH:mm")),new Clipboard("#copy-timeslot-red"),new Clipboard("#copy-timeslot-green"),new Clipboard("#copy-timeslot-blue"),$("#copy-timeslot").removeClass("hidden")}function newGuid(){return(S4()+S4()+"-"+S4()+"-4"+S4().substr(0,3)+"-"+S4()+"-"+S4()+S4()+S4()).toLowerCase()}function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}
function getMapChartColor(e,t,a){var s=0,r=1;switch(t){case 34:s=.09;break;case 95:s=.15;break;case 96:s=.3;break;case 1099:case 97:s=.45}s*=r,a&&(s=-.75+s);var o=shadeColor(colorNameToHex(e),s);return o}function colorNameToHex(e){var t={blue:"#0000ff",green:"#008000",red:"#ff0000"};return void 0!==t[e.toLowerCase()]&&t[e.toLowerCase()]}function shadeColor(e,t){var a=parseInt(e.slice(1),16),s=t<0?0:255,r=t<0?-1*t:t,o=a>>16,i=a>>8&255,l=255&a;return"#"+(16777216+65536*(Math.round((s-o)*r)+o)+256*(Math.round((s-i)*r)+i)+(Math.round((s-l)*r)+l)).toString(16).slice(1)}function blendColors(e,t,a){var s=parseInt(e.slice(1),16),r=parseInt(t.slice(1),16),o=s>>16,i=s>>8&255,l=255&s,n=r>>16,d=r>>8&255,c=255&r;return"#"+(16777216+65536*(Math.round((n-o)*a)+o)+256*(Math.round((d-i)*a)+i)+(Math.round((c-l)*a)+l)).toString(16).slice(1)}function getWidths(e,t){var a=null;return a=0==e&&0==t?{kills:"50%",deaths:"50%"}:{kills:(100*e/(e+t)).toString()+"%",deaths:(100*t/(e+t)).toString()+"%"},a}function getKdr(e,t){return e>0?t>0?parseFloat(Math.round(e/t*100)/100).toFixed(2):"&infin;":"0.00"}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),a=t.exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))}function checkParameter(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"([^&#]*)"),a=t.exec(location.search);return null!==a}function getLongestInArray(e){return e.sort(function(e,t){return t.length-e.length})[0]}function cmpColor(e,t){return"red"==e.color?3:"blue"==e.color?2:1}var m_oHighchartsKills,_CURRENT_MATCH_ID,_CURRENT_MATCH,m_bDebug=!1,m_oDataTableRanking=null,m_bFlattening=!0,_STATISTICS_VIEW=null,_CURSOR=null,_WORLDS=null,_API_BASE="https://api.kills.werdes.net/api/",_SETTINGS={flattening:!0,smoothing:!1,darkmode:!0,dismissed_objects:new Array,range_selection:!0},ENUM_VIEW={NONE:0,MATCHLIST:1,MATCH:2,WORLD_RANKING:3,LEGAL:4,TIMEZONES:5},_CURRENT_SELECTED_RANGE={min:null,max:null};$(function(){setView(ENUM_VIEW.NONE),loadSettings(),checkDarkmode(),new Clipboard("#copy-shortlink"),setCurrentMatchlistMainMenu(),loadMessages(),checkTips();var e=$.sammy(function(){this.get("#/matches/current/",function(e){setCurrentMatchlist()}),this.get("#/matches/archive/:page/",function(e){var t=this.params.page;alert(t),setAllMatchlist()}),this.get("#/worldranking/",function(e){setWorldRanking()}),this.get("#/timezones/",function(e){setTimezones()}),this.get("#/matches/:slug/",function(e){var t=this.params.slug;resolveSlug(t,function(e){null!=e?setSpecificMatch(e.match_id):window.location="#/matches/current/"})}),this.get("#/legal/",function(e){setView(ENUM_VIEW.NONE),setLoading(!0),$("#legal-notice").load("legal.html"),setLoading(!1),setView(ENUM_VIEW.LEGAL)}),this.bind("location-changed",function(e,t){handlePageSwitch(e.currentTarget.baseURI)})});e.run("#/matches/current/"),$("#current-year").text(moment().format("YYYY"))}),$(".nightmode-switch").click(function(){toggleNightmode()}),$("#button-close-tip-copystats").click(function(){$("#information-addon-copystats").addClass("hidden"),_SETTINGS.dismissed_objects.push("tip_copystats"),storeSettings()}),$("#button-close-tip-timezones").click(function(){$("#information-addon-timezones").addClass("hidden"),_SETTINGS.dismissed_objects.push("tip_timezones"),storeSettings()}),$("#button-close-tip-time-range-selection").click(function(){$("#information-addon-time-range-selection").addClass("hidden"),_SETTINGS.dismissed_objects.push("tip_timerangeselection"),storeSettings()}),$("#modal-shortlink").on("shown.bs.modal",function(e){var t=$(e.relatedTarget),a=(t.attr("data-match-slug"),window.location.href);$("#shortlink-textbox").val(a),$("#shortlink-textbox").select()}),$(".checkable > a").click(function(){var e=$(this).attr("data-target"),t=!("true"==$(this).attr("data-value"));_SETTINGS[e]=t,$(this).find(".glyphicon").css("opacity",t?1:0),$(this).attr("data-value",t),storeSettings(),setSpecificMatch(_CURRENT_MATCH_ID)}),$("#reload-chart").click(function(){setSpecificMatch(_CURRENT_MATCH_ID)}),$(".copy-timeslot").click(function(){var e=$(this).attr("data-timeslot-id"),t=$(this).attr("data-world-id");$(this).attr("data-clipboard-text",getClipboard(_CURRENT_MATCH,t,e)),$("#copy-timeslot").addClass("hidden")}),$("#copy-timeslot-cancel").click(function(){$("#copy-timeslot").addClass("hidden"),new Clipboard(this)}),$("body").click(function(){$("#copy-timeslot").addClass("hidden")}),Highcharts.Point.prototype.tooltipFormatter=function(e){var t=this;t.series;0==t.seriesindex&&setStatistics(t.timeslot_id);var a=t.flattened&&0==t.seriesindex?"<br />! This value has been altered by the error correction mechanism !":"";return a},$("#main-chart-container").mouseleave(function(){setStatistics(-1)}),$(document).on("mousemove",function(e){_CURSOR={x:e.pageX,y:e.pageY}}),$("#matchlist-search").on("input",function(){var e=$(this).val().toUpperCase();$("#matchlist-container > div").removeClass("hidden"),$("#matchlist-container > div").each(function(){var t=$(this).attr("data-search-query").toUpperCase();-1==t.indexOf(e)&&$(this).addClass("hidden")})}),$("#matchlist-search").keyup(function(e){27==e.keyCode&&($(this).val(""),$("#matchlist-container > div").removeClass("hidden"))}),String.prototype.toProperCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},Number.prototype.toFixedLeading=function(e,t){var a=new Array(e+1).join("0");return(a+this.toFixed(t)).slice(-1*(e+t+1))},Number.prototype.toThousandSeparator=function(){return this.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")},String.prototype.replaceAll=function(e,t){for(var a=this;a.includes(e);)a=a.replace(e,t);return a};