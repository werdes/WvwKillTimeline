function checkNightmode(){var t=$.cookie("nightmode");void 0!=t&&null!=t||($.cookie("nightmode","false",{expires:365}),t=$.cookie("nightmode")),"false"==t?$('head link[rel="stylesheet"][href="css/nightmode.min.css"]').remove():$("head").append('<link rel="stylesheet" type="text/css" href="css/nightmode.min.css">')}function toggleNightmode(){var t=$.cookie("nightmode");"false"==t?$.cookie("nightmode","true",{expires:365}):$.cookie("nightmode","false",{expires:365}),checkNightmode()}function setView(t){$("#matchlist").addClass("hidden"),$("#match").addClass("hidden"),$("#world-ranking").addClass("hidden"),$("#legal-notice").addClass("hidden"),$("#matchlist-search").val(""),$("div.header").addClass("disabled"),t==ENUM_VIEW.NONE?($("body").children(".fixedHeader").each(function(){$(this).remove()}),null!=m_oDataTableRanking&&(m_oDataTableRanking.clear(),m_oDataTableRanking.destroy(),m_oDataTableRanking=null)):t==ENUM_VIEW.MATCH?($("#match").removeClass("hidden"),$("div.header").removeClass("disabled")):t==ENUM_VIEW.MATCHLIST?($("#matchlist").removeClass("hidden"),$("div.header").removeClass("disabled")):t==ENUM_VIEW.WORLD_RANKING?($("#world-ranking").removeClass("hidden"),$("div.header").removeClass("disabled")):t==ENUM_VIEW.LEGAL&&($("#legal-notice").removeClass("hidden"),$("div.header").removeClass("disabled"))}function getMaps(t){var e=new Array;return e[38]="Eternal Battlegrounds",e[94]=t.red+" Borderlands",e[95]=t.green+" Borderlands",e[96]=t.blue+" Borderlands",e[1099]=t.red+" Borderlands",e}function getMapColors(){var t=new Array;return t[38]="#333",t[94]="red",t[95]="green",t[96]="blue",t[1099]="red",t}function getWorlds(t){var e=new Array;e.red=null,e.green=null,e.blue=null;for(var a in t.series){var r=t.series[a];e[r.color]=r.world_name}return e}function resolveSlug(t,e){$.ajax({url:"api/slug/"+t+"?"+$.now(),caching:!1,dataType:"json",complete:function(t){null!=t&&null!=t.responseJSON&&e(t.responseJSON)},error:function(t,e,a){setMessage("<b>"+e+"</b><br />"+a,"danger"),setView(ENUM_VIEW.MATCHLIST)}})}function setSpecificMatch(t){setLoading(!0),setView(ENUM_VIEW.NONE),$.ajax({url:"api/matchlist/single/"+t+"?"+$.now(),caching:!1,dataType:"json",complete:function(e){for(var a in e.responseJSON){var r=e.responseJSON[a];if(r.id==t){setMatch(r.id,r);break}}},error:function(t,e,a){setMessage("<b>"+e+"</b><br />"+a,"danger"),setView(ENUM_VIEW.MATCHLIST)}})}function setWorldRanking(){setView(ENUM_VIEW.NONE),setLoading(!0),$.ajax({url:"api/worldranking?"+$.now(),dataType:"json",complete:function(t){m_oDataTableRanking=$("#table-world-ranking").DataTable({order:[[6,"desc"]],paging:!1,info:!1,searching:!0});for(var e in t.responseJSON){var a=t.responseJSON[e];for(var r in a.linkings){var s=a.linkings[r],i="",n=0;for(var o in s.partners)0==n&&(i+=", "),i+=s.partners[o].name,n++,n<s.partners.length&&(i+=", ");var l='<i class="famfamfam-flag-'+getFlagShort(a.arenanet_id)+'"></i> <b>'+a.name+"</b>";m_oDataTableRanking.row.add([l+i,s.matchcount.toString(),s.kills.toThousandSeparator(),s.deaths.toThousandSeparator(),(s.kills/s.matchcount).toFixed(2).toString(),(s.deaths/s.matchcount).toFixed(2).toString(),getKdr(s.kills,s.deaths)]).draw(!1)}}setView(ENUM_VIEW.WORLD_RANKING),setLoading(!1),new $.fn.dataTable.FixedHeader(m_oDataTableRanking,{})},error:function(t,e,a){setMessage("<b>"+e+"</b><br />"+a,"danger")}})}function setAllMatchlist(){var t="#matchlist-container";setLoading(!0),$(t).html(""),resetChart(),setView(ENUM_VIEW.NONE),$.ajax({url:"api/matchlist/all?"+$.now(),dataType:"json",complete:function(e){setView(ENUM_VIEW.NONE);var a="";for(var r in e.responseJSON){var s=e.responseJSON[r],i=moment(s.start).utc().format("YYYY.MM.DD");i!=a&&($(t).append("<h2>"+moment(s.start).format("YYYY.MM.DD")+" - "+moment(s.end).format("YYYY.MM.DD")+"</h2>"),a=i),setMatchlistMatchContainer(t,r,s)}setLoading(!1),setView(ENUM_VIEW.MATCHLIST)},error:function(t,e,a){setMessage("<b>"+e+"</b><br />"+a,"danger")}})}function setCurrentMatchlistMainMenu(){var t="#menu-current-matchups";$.ajax({url:"api/matchlist/current?"+$.now(),dataType:"json",complete:function(e){for(var a in e.responseJSON){var r=e.responseJSON[a],s=r.arenanet_id.split("-")[1],i="1"==r.arenanet_id.split("-")[0]?"NA":"EU",n="#/matches/"+getLongestInArray(r.slugs)+"/";$(t).append('<li data-match-id="'+r.id+'" id="menu-'+a+'"></li>');var o='<a href="'+n+'"><b>'+i+"</b>/<b>T"+s+"</b> ",l=0;for(var d in r.worlds){var c=r.worlds[d];l>0&&(o+=" - "),o+='<i class="famfamfam-flag-'+getFlagShort(c.id)+'"></i> ',o+=c.name,l++}o+="</a>",$("#menu-"+a).append(o),$("#menu-"+a).click(function(){$("#current-matches-dropdown").dropdown("toggle")})}},error:function(t,e,a){setMessage("<b>"+e+"</b><br />"+a,"danger")}})}function setCurrentMatchlist(){var t="#matchlist-container";$(t).html(""),setView(ENUM_VIEW.NONE),setLoading(!0),$.ajax({url:"api/matchlist/current?"+$.now(),dataType:"json",complete:function(e){setView(ENUM_VIEW.NONE);for(var a in e.responseJSON)setMatchlistMatchContainer(t,a,e.responseJSON[a]);setLoading(!1),setView(ENUM_VIEW.MATCHLIST)},error:function(t,e,a){setMessage("<b>"+e+"</b><br />"+a,"danger")}})}function setMatchlistMatchContainer(t,e,a){var r=a.arenanet_id.split("-")[1],s="1"==a.arenanet_id.split("-")[0]?"NA":"EU",i=m_bDebug?e:"",n=new Array;n.push("T"+r),n.push("Tier"+r),n.push(s),n.push(a.start),n.push(a.end),n.push(moment(a.start).format("YYYY.MM.DD")),n.push(moment(a.end).format("YYYY.MM.DD"));var o="#/matches/"+getLongestInArray(a.slugs)+"/";console.log(o),$(t).append('<div id="'+e+'" class="list-group-item"><div class="row"><div class="col-md-1"><div class="matchlist-eyecatcher"><span class="matchlist-region">'+s+'</span><span class="matchlist-tier">Tier '+r+'</span></div></div><div class="col-md-10"><a class="match-container" data-match-id="'+a.id+'"></a></div><div class="col-md-1"><a class="get-shortlink btn btn-default btn-xs pull-right" data-toggle="modal" data-target="#modal-shortlink" role="button" data-match-slug="'+getLongestInArray(a.slugs)+'"><i class="glyphicon glyphicon-link"></i> Shortlink</a>'+i+"</div></div></div>");var l='<div class="matchlist-worldlist">';for(var d in a.worlds){var c=a.worlds[d],h=parseInt(c.kills)/parseInt(c.deaths),m=h>=1?"success":"danger";if(l+='<div class="row"><div class="col-md-1">',l+='<span title="Kills: '+c.kills+" / Deaths: "+c.deaths+'" class="label label-'+m+'">KD: '+getKdr(c.kills,c.deaths)+"</span>",l+='</div><div class="col-md-11 matchlist-world-container"><b><i class="famfamfam-flag-'+getFlagShort(c.id)+'"></i> '+c.name+"</b>",n.push(c.name),null!=c.additional_worlds)for(var g in c.additional_worlds)l+=", "+c.additional_worlds[g].name,n.push(c.additional_worlds[g].name);l+="</div></div>"}l+="</a></div>",$("#"+e+" a.match-container").append(l),$("#"+e).attr("data-search-query",n.join("#")),$("#"+e+" a.match-container").click(function(){window.location=o})}function setMatch(t,e){setView(ENUM_VIEW.NONE),setLoading(!0),resetChart(),m_oHighchartsKills=new Highcharts.stockChart(getChartOptions()),$("#disable-flattening").removeClass("hidden"),$("#enable-flattening").removeClass("hidden");var a=m_bFlattening?"flattened":"unaltered";$.ajax({url:"api/match/"+t+"/"+a+"?"+$.now(),dataType:"json",complete:function(a){var r=a.responseJSON,s=0,i=getWorlds(r),n=getMaps(i),o=0,l=0,d=e.arenanet_id.split("-")[1],c="1"==e.arenanet_id.split("-")[0]?"NA":"EU",h=getLongestInArray(e.slugs);$("div#match > a.get-shortlink").attr("data-match-slug",h),$("#match-title").html(moment(r.match_start).format("YYYY.MM.DD")+" - "+moment(r.match_end).format("YYYY.MM.DD")+" <small>"+c+" Tier "+d+"</small>"),m_oHighchartsKills.setTitle({text:i.green+" / "+i.blue+" / "+i.red}),$("#disable-flattening").addClass("hidden"),$("#enable-flattening").addClass("hidden"),r.flattening_requested&&r.flattened?$("#disable-flattening").removeClass("hidden"):r.flattening_requested||$("#enable-flattening").removeClass("hidden");var m=0,g=r.series[Object.keys(r.series)[0]];for(var u in g.series_items){var p=(g.series_items[u],0),f=0;for(var v in r.series)oSeries=r.series[v],p+=parseInt(oSeries.series_items[m].kills),f+=parseInt(oSeries.series_items[m].deaths);p>o&&(o=p),f>l&&(l=f),m++}var w=o;l>w&&(w=l),l*=-1,m_oHighchartsKills.yAxis[0].update({min:w*-1-100,max:0}),m_oHighchartsKills.yAxis[1].update({min:0,max:w+100});for(var v in r.series)setSeries(r.series[v],i,n,s,"Kills"),s++;for(var v in r.series)setSeries(r.series[v],i,n,s,"Deaths"),s++;setMatchStatistics(r,e),$("#reload-chart").attr("data-match-id",t),$("#disable-flattening").attr("data-match-id",t),$("#enable-flattening").attr("data-match-id",t),r.flattened&&setMessage("Due to issues with the <strong>Guild Wars 2 API</strong> the data of this match has been flattened to be more precise.<br />Please note, that this has altered the timeline of when kills occured. The kill and death counts are correct. I know it's not pretty, but that's as much as i can do ðŸ”¥.","warning"),m_oHighchartsKills.redraw(),setLoading(!1),setView(ENUM_VIEW.MATCH)},error:function(t,e,a){setMessage("<b>"+e+"</b><br />"+a,"danger")}})}function setMessage(t,e){$("#message-container").append('<div class="alert alert-'+e+' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+t+"</div>")}function clearMessages(){$("#message-container").html("")}function setSeries(t,e,a,r,s){var i="Deaths"==s;m_oHighchartsKills.addSeries({name:"["+s+"] "+t.world_name+" on "+a[t.map_id],yAxis:i?0:1,type:"area",step:"center",color:getMapChartColor(t.color,t.map_id,i)});for(var n in t.series_items){var o=t.series_items[n],l=i?parseInt(o.deaths)*-1:parseInt(o.kills),d=null;o.flattened&&0==r&&(d={symbol:"url(img/warning_marker.png)"}),m_oHighchartsKills.series[r].addPoint({x:Date.parse(o.timeslot_start),y:l,name:o.timeslot_start+" to "+o.timeslot_end,world:t.world_id,map:t.map_id,kills:parseInt(o.kills),deaths:parseInt(o.deaths),flattened:o.flattened,seriesindex:r,marker:d},!1)}}function setMatchStatistics(t,e){var a="#match-statistics-container",r=new Array,s=getMapColors();$(a).html("");for(var i in t.series){var n=t.series[i],o=n.world_id;"undefined"==typeof r[o]&&(r[o]={world_id:n.world_id,color:n.color,world_name:n.world_name,maps:new Array}),r[o].maps[n.map_id]={map_id:n.map_id,kills:0,deaths:0};for(var l in n.series_items){var d=n.series_items[l];r[o].maps[n.map_id].kills+=parseInt(d.kills),r[o].maps[n.map_id].deaths+=parseInt(d.deaths)}}var c='<div class="row">';for(var h in r){oWorld=r[h],c+='<div class="col-md-4 world-container '+oWorld.world_id+'" data-world-name="'+oWorld.world_name+'">',c+='<div class="row"><div class="col-md-9"><h4>'+oWorld.world_name+'</h4><span class="copy-statistics copy-'+oWorld.world_id+'" title="Copy statistics to clipboard"><i class="glyphicon glyphicon-copy"></i></span></div><div class="col-md-3 world-kd '+oWorld.world_id+'"><h4>&empty;1.00</h4></div></div><h6>';var m=0;for(var g in e.worlds[oWorld.color].additional_worlds)m++,c+=e.worlds[oWorld.color].additional_worlds[g].name,m<Object.keys(e.worlds[oWorld.color].additional_worlds).length&&(c+=", ");c+="&nbsp;</h6>";for(var u in oWorld.maps){var p=oWorld.maps[u],f="38"==p.map_id?"EBG":"Border",v=getKdr(p.kills,p.deaths),w=getWidths(parseInt(p.kills),parseInt(p.deaths));c+='<div class="row kd" data-kills="'+p.kills+'" data-deaths="'+p.deaths+'" data-world="'+oWorld.world_id+'" data-map-id="'+u+'" data-color="'+s[p.map_id]+'" data-world-name="'+oWorld.world_name+'" data-map-name="'+f+'">',c+='<div class="col-md-2" style="color: '+s[p.map_id]+'">'+f+'</div><div class="col-md-7"><div class="progress"><div class="progress-bar '+u+" "+oWorld.world_id+' kills no-nightmode" title="kills" role="progressbar" style="width: '+w[0]+"%; background-color: "+getMapChartColor(oWorld.color,p.map_id,!1)+';"  >'+p.kills+'</div><div class="progress-bar '+u+" "+oWorld.world_id+' deaths no-nightmode" style="width: '+w[1]+"%; background-color: "+getMapChartColor(oWorld.color,p.map_id,!0)+';" title="deaths">'+p.deaths+'</div></div></div><div class="col-md-3 '+u+" "+oWorld.world_id+' kdr">&empty;'+v+"</div>",c+="</div>"}c+="</div>"}c+="</div>",$(a).append(c),$("span.copy-statistics").click(function(){$(this).addClass("highlight"),setTimeout(function(){$(".highlight").removeClass("highlight")},1e3)});for(var h in r){for(var b in r[h].maps)setWorldKdr(r[h].world_id,r[h].maps[b].kills,r[h].maps[b].deaths);$(".copy-"+r[h].world_id).attr("data-clipboard-text",getClipboardWorld(r[h].world_id)),new Clipboard(".copy-"+r[h].world_id)}}function getClipboardWorld(t){var e=0,a=0,r=new Array,s=$(".world-container."+t).attr("data-world-name");$(".world-container."+t).children(".row.kd").each(function(){var t=parseInt($(this).attr("data-kills")),s=parseInt($(this).attr("data-deaths")),i=($(this).attr("data-world-name"),$(this).attr("data-map-name")),n=$(this).attr("data-color");e+=s,a+=t;var o=getKdr(t,s)+" k/d ("+t+"/"+s+") on ";n.indexOf("#")==-1&&(o+=n.toProperCase()+" "),o+=i,r.push(o)});var i=s+": "+getKdr(a,e)+" k/d ("+a+"/"+e+") | ";return i+r.join(" | ")}function resetChart(){void 0!=m_oHighchartsKills&&null!=m_oHighchartsKills&&(m_oHighchartsKills.destroy(),m_oHighchartsKills=void 0,$("main-chart-container").html(""))}function getFlagShort(t){var e=t.substring(0,2);switch(e){case"10":return"us";case"20":return"eu";case"21":return"fr";case"22":return"de";case"23":return"es"}}function setLoading(t){$("#loading-container").removeClass("hidden"),t?clearMessages():$("#loading-container").addClass("hidden")}function getChartOptions(){Highcharts.setOptions({global:{useUTC:!1}});var t={chart:{backgroundColor:"transparent",renderTo:"main-chart-container",height:500,zoomType:"xy",spacingLeft:0,spacingRight:0},rangeSelector:{enabled:!1},scrollbar:{liveRedraw:!1},navigator:{adaptToUpdatedData:!1},xAxis:{type:"datetime",range:864e5,labels:{align:"left",formatter:function(){var t=moment(this.value).add(15,"minutes").format("HH:mm");return t}}},title:{text:" "},yAxis:[{allowDecimals:!1,title:{text:"deaths"},opposite:!0,gridLineWidth:0,visible:!1,labels:{formatter:function(){return Math.abs(this.value)}}},{allowDecimals:!1,opposite:!0,gridLineWidth:0,labels:{formatter:function(){return Math.abs(this.value)}}}],plotOptions:{area:{stacking:"normal",marker:{}}},series:[]};return t}function newGuid(){return(S4()+S4()+"-"+S4()+"-4"+S4().substr(0,3)+"-"+S4()+"-"+S4()+S4()+S4()).toLowerCase()}function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function getMapChartColor(t,e,a){var r=0,s=1;switch(e){case"34":r=.09;break;case"95":r=.15;break;case"96":r=.3;break;case"1099":case"97":r=.45}r*=s,a&&(r=-.75+r);var i=shadeColor(colorNameToHex(t),r);return i}function colorNameToHex(t){var e={blue:"#0000ff",green:"#008000",red:"#ff0000"};return"undefined"!=typeof e[t.toLowerCase()]&&e[t.toLowerCase()]}function shadeColor(t,e){var a=parseInt(t.slice(1),16),r=e<0?0:255,s=e<0?e*-1:e,i=a>>16,n=a>>8&255,o=255&a;return"#"+(16777216+65536*(Math.round((r-i)*s)+i)+256*(Math.round((r-n)*s)+n)+(Math.round((r-o)*s)+o)).toString(16).slice(1)}function blendColors(t,e,a){var r=parseInt(t.slice(1),16),s=parseInt(e.slice(1),16),i=r>>16,n=r>>8&255,o=255&r,l=s>>16,d=s>>8&255,c=255&s;return"#"+(16777216+65536*(Math.round((l-i)*a)+i)+256*(Math.round((d-n)*a)+n)+(Math.round((c-o)*a)+o)).toString(16).slice(1)}function setTotalNumbersInStatistics(t){var e=$(t).data("kills"),a=$(t).data("deaths"),r=$(t).find(".progress-bar.deaths"),s=$(t).find(".progress-bar.kills"),i=$(t).find(".kdr"),n=getWidths(e,a),o=getKdr(e,a);$(r).text(a),$(s).text(e),$(r).css("width",n[1]+"%"),$(s).css("width",n[0]+"%"),$(i).html("&empty;"+o),setWorldKdr($(t).attr("data-world"),e,a),m_oHighchartsKills.setTitle({text:m_oHighchartsKills.title.textStr})}function getWidths(t,e){var a=new Array;return a=0==t&&0==e?[50,50]:[100*t/(t+e),100*e/(t+e)]}function getKdr(t,e){return t>0?e>0?parseFloat(Math.round(t/e*100)/100).toFixed(2):"&infin;":"0.00"}function getParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),a=e.exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))}function checkParameter(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"([^&#]*)"),a=e.exec(location.search);return null!==a}function setWorldKdr(t,e,a){var r=".world-kd."+t,s=$(r).attr("data-count");if("undefined"==typeof s?($(r).attr("data-count",0),$(r).attr("data-kills",0),$(r).attr("data-deaths",0),s=0):s=parseInt(s),$(r).attr("data-count",s+1),$(r).attr("data-kills",parseInt($(r).attr("data-kills"))+e),$(r).attr("data-deaths",parseInt($(r).attr("data-deaths"))+a),s=$(r).attr("data-count"),4==s){var i=parseInt($(r).attr("data-kills")),n=parseInt($(r).attr("data-deaths"));$(r).html("<h4>&empty;"+getKdr(i,n)+"</h4>"),$(r).attr("data-count",0),$(r).attr("data-kills",0),$(r).attr("data-deaths",0)}}function getLongestInArray(t){return t.sort(function(t,e){return e.length-t.length})[0]}var m_oHighchartsKills,m_bDebug=!1,m_oDataTableRanking=null,m_bFlattening=!0;$(function(){checkNightmode(),new Clipboard("#copy-shortlink"),setCurrentMatchlistMainMenu();var t=$.sammy(function(){this.get("#/matches/current/",function(t){setCurrentMatchlist()}),this.get("#/matches/all/",function(t){setAllMatchlist()}),this.get("#/worldranking/",function(t){setWorldRanking()}),this.get("#/matches/:slug/",function(t){var e=this.params.slug;resolveSlug(e,function(t){setSpecificMatch(t.match_id)})}),this.get("#/legal/",function(t){setView(ENUM_VIEW.NONE),setLoading(!0),$("#legal-notice").load("legal.html"),setLoading(!1),setView(ENUM_VIEW.LEGAL)})});t.run("#/matches/current/")});var ENUM_VIEW={NONE:0,MATCHLIST:1,MATCH:2,WORLD_RANKING:3,LEGAL:4};$(".nightmode-switch").click(function(){toggleNightmode()}),$("#modal-shortlink").on("shown.bs.modal",function(t){var e=$(t.relatedTarget),a=(e.attr("data-match-slug"),window.location.href);$("#shortlink-textbox").val(a),$("#shortlink-textbox").select()}),$("#reload-chart").click(function(){var t=$(this).attr("data-match-id");setSpecificMatch(t)}),$("#disable-flattening").click(function(){m_bFlattening=!1;var t=$(this).attr("data-match-id");setSpecificMatch(t)}),$("#enable-flattening").click(function(){m_bFlattening=!0;var t=$(this).attr("data-match-id");setSpecificMatch(t)}),Highcharts.Point.prototype.tooltipFormatter=function(t){var e=this,a=(e.series,".progress-bar.kills."+e.map+"."+e.world),r=".progress-bar.deaths."+e.map+"."+e.world,s=".kdr."+e.map+"."+e.world,i=getKdr(e.kills,e.deaths),n=getWidths(e.kills,e.deaths);$(a).text(e.kills),$(r).text(e.deaths),$(s).html("&empty;"+i),$(a).css("width",n[0]+"%"),$(r).css("width",n[1]+"%"),setWorldKdr(e.world,e.kills,e.deaths);var o=e.flattened&&0==e.seriesindex?"<br />! This value has been altered by the error correction mechanism !":"";return o},$("#main-chart-container").mouseleave(function(){$(".row.kd").each(function(){setTotalNumbersInStatistics(this)})}),$("#matchlist-search").on("input",function(){var t=$(this).val().toUpperCase();$("#matchlist-container > div").removeClass("hidden"),$("#matchlist-container > div").each(function(){var e=$(this).attr("data-search-query").toUpperCase();e.indexOf(t)==-1&&$(this).addClass("hidden")})}),$("#matchlist-search").keyup(function(t){27==t.keyCode&&($(this).val(""),$("#matchlist-container > div").removeClass("hidden"))}),String.prototype.toProperCase=function(){return this.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})},Number.prototype.toThousandSeparator=function(){return this.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")};